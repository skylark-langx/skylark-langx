/**
 * skylark-langx - A simple JavaScript language extension library, including class support, Evented class, Deferred class and some commonly used tool functions.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.5
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./klass"],function(t){function a(n){var i;return n&&((i=!!n.then)&&(n=Object.delegate(n)),t("forEach"),t("filter"),t("map"),null==n.total)&&(n.total=Deferred.when(n,function(t){return t.length})),n;function t(e){n[e]=function(){var r=arguments,t=Deferred.when(n,function(t){return a(Array.prototype[e].apply(t,r))});if("forEach"!==e||i)return t}}}return t({klassName:"ArrayStore",queryEngine:function(e,n){switch(typeof e){default:throw new Error("Can not query with a "+typeof e);case"object":case"undefined":var i=e;e=function(t){for(var r in i){var e=i[r];if(e&&e.test){if(!e.test(t[r],t))return!1}else if(e!=t[r])return!1}return!0};break;case"string":if(!this[e])throw new Error("No filter function "+e+" was found in store");e=this[e];case"function":}function t(t){var r,t=function(t,r,e){var n,i=0,a=t&&t.length||0,o=[];if(a&&"string"==typeof t&&(t=t.split("")),"string"==typeof r&&(r=cache[r]||buildFn(r)),e)for(;i<a;++i)n=t[i],r.call(e,n,i,t)&&o.push(n);else for(;i<a;++i)r(n=t[i],i,t)&&o.push(n);return o}(t,e),o=n&&n.sort;return o&&t.sort("function"==typeof o?o:function(t,r){for(var e,n=0;e=o[n];n++){var i=t[e.attribute],a=r[e.attribute];if((i=null!=i?i.valueOf():i)!=(a=null!=a?a.valueOf():a))return!!e.descending==(null==i||a<i)?-1:1}return 0}),n&&(n.start||n.count)&&(r=t.length,(t=t.slice(n.start||0,(n.start||0)+(n.count||1/0))).total=r),t}return t.matches=e,t},idProperty:"id",get:function(t){return this.data[this.index[t]]},getIdentity:function(t){return t[this.idProperty]},put:function(t,r){var e=this.data,n=this.index,i=this.idProperty,i=t[i]=r&&"id"in r?r.id:i in t?t[i]:Math.random();if(i in n){if(r&&!1===r.overwrite)throw new Error("Object already exists");e[n[i]]=t}else n[i]=e.push(t)-1;return i},add:function(t,r){return(r=r||{}).overwrite=!1,this.put(t,r)},remove:function(t){var r=this.index,e=this.data;if(t in r)return e.splice(r[t],1),this.setData(e),!0},query:function(t,r){return a(this.queryEngine(t,r)(this.data))},setData:function(t){t.items?(this.idProperty=t.identifier||this.idProperty,t=this.data=t.items):this.data=t,this.index={};for(var r=0,e=t.length;r<e;r++)this.index[t[r][this.idProperty]]=r},init:function(t){for(var r in t)this[r]=t[r];this.setData(this.data||[])}})});
//# sourceMappingURL=sourcemaps/array-store.js.map
