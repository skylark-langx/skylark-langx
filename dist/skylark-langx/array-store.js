/**
 * skylark-langx - A simple JavaScript language extension library, including class support, Evented class, Deferred class and some commonly used tool functions.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.5
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./klass"],function(t){var r=function(t){if(!t)return t;var e=!!t.then;function n(n){t[n]=function(){var i=arguments,a=Deferred.when(t,function(t){return r(Array.prototype[n].apply(t,i))});if("forEach"!==n||e)return a}}return e&&(t=Object.delegate(t)),n("forEach"),n("filter"),n("map"),null==t.total&&(t.total=Deferred.when(t,function(t){return t.length})),t};return t({klassName:"ArrayStore",queryEngine:function(t,r){switch(typeof t){default:throw new Error("Can not query with a "+typeof t);case"object":case"undefined":var e=t;t=function(t){for(var r in e){var n=e[r];if(n&&n.test){if(!n.test(t[r],t))return!1}else if(n!=t[r])return!1}return!0};break;case"string":if(!this[t])throw new Error("No filter function "+t+" was found in store");t=this[t];case"function":}function n(e){var n=function(t,r,e){var n,i=0,a=t&&t.length||0,o=[];if(a&&"string"==typeof t&&(t=t.split("")),"string"==typeof r&&(r=cache[r]||buildFn(r)),e)for(;i<a;++i)n=t[i],r.call(e,n,i,t)&&o.push(n);else for(;i<a;++i)r(n=t[i],i,t)&&o.push(n);return o}(e,t),i=r&&r.sort;if(i&&n.sort("function"==typeof i?i:function(t,r){for(var e,n=0;e=i[n];n++){var a=t[e.attribute],o=r[e.attribute];if((a=null!=a?a.valueOf():a)!=(o=null!=o?o.valueOf():o))return!!e.descending==(null==a||a>o)?-1:1}return 0}),r&&(r.start||r.count)){var a=n.length;(n=n.slice(r.start||0,(r.start||0)+(r.count||1/0))).total=a}return n}return n.matches=t,n},idProperty:"id",get:function(t){return this.data[this.index[t]]},getIdentity:function(t){return t[this.idProperty]},put:function(t,r){var e=this.data,n=this.index,i=this.idProperty,a=t[i]=r&&"id"in r?r.id:i in t?t[i]:Math.random();if(a in n){if(r&&!1===r.overwrite)throw new Error("Object already exists");e[n[a]]=t}else n[a]=e.push(t)-1;return a},add:function(t,r){return(r=r||{}).overwrite=!1,this.put(t,r)},remove:function(t){var r=this.index,e=this.data;if(t in r)return e.splice(r[t],1),this.setData(e),!0},query:function(t,e){return r(this.queryEngine(t,e)(this.data))},setData:function(t){t.items?(this.idProperty=t.identifier||this.idProperty,t=this.data=t.items):this.data=t,this.index={};for(var r=0,e=t.length;r<e;r++)this.index[t[r][this.idProperty]]=r},init:function(t){for(var r in t)this[r]=t[r];this.setData(this.data||[])}})});
//# sourceMappingURL=sourcemaps/array-store.js.map
